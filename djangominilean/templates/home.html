<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">
<head>
  <meta charset="utf-8" />
  <title>django mini-lean</title>
  <!--
  <script type="text/javascript" src="{{ MEDIA_URL }}js/jquery-1.6.2.min.js"></script>
  <script type="text/javascript" src="{{ MEDIA_URL }}js/jquery.form.js"></script>
  <script type="text/javascript" src="{{ MEDIA_URL }}js/jquery.ghosttext.js"></script>  
  <script type="text/javascript" src="{{ MEDIA_URL }}js/jquery.validate.min.js"></script>    
  -->
  <meta property="fb:app_id" content="{{FB_APPID}}" /> 
  <script type="text/javascript" src="{{ STATIC_URL }}js/jquery-1.10.2.min.js"></script>
</head>

{% block headscript %}
<meta property="og:url" content="http://demdash.us/friends" />
<meta property="og:image" content="http://demdash.us{{ MEDIA_URL }}img/{{img}}" />
<meta property="og:title" content="Democracy Dashboard" />
<meta property="og:description" content="Curious to see how political your Facebook feed is?" />
<meta property="og:type" content="website" />

<script type="text/javascript">
$.ajaxSetup({ 
     beforeSend: function(xhr, settings) {
         function getCookie(name) {
             var cookieValue = null;
             if (document.cookie && document.cookie != '') {
                 var cookies = document.cookie.split(';');
                 for (var i = 0; i < cookies.length; i++) {
                     var cookie = jQuery.trim(cookies[i]);
                     // Does this cookie string begin with the name we want?
                 if (cookie.substring(0, name.length + 1) == (name + '=')) {
                     cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                     break;
                 }
             }
         }
         return cookieValue;
         }
         if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {
             // Only send the token to relative URLs i.e. locally.
             xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
         }
     } 
});

window.fbAsyncInit = function() {
  FB.init({
    appId      : '{{FB_APPID}}',
    status     : true,
    logging    : true,
    cookie     : true,
    xfbml      : true,
    oauth      : true,
  });
};
(function(d){
   var js, id = 'facebook-jssdk'; if (d.getElementById(id)) {return;}
   js = d.createElement('script'); js.id = id; js.async = true;
   js.src = "//connect.facebook.net/en_US/all.js";
   d.getElementsByTagName('head')[0].appendChild(js);
 }(document));

function fb_publish() {
    v0 = Math.floor(Math.random()*2);
    v1 = Math.floor(Math.random()*2);
    console.log(v0, v1);
    msgpart1 = '{{request.user.get_profile.fname}} is {{nums.pct|floatformat:'0'}}% {{nums.ideology}} and {{nums.total|floatformat:'0'}}% political overall. ';
    msgs = Array('Curious to see how political your Facebook feed is?', 'Curious to see how your friends are connected?')
    images = Array("cow1.png", "cow2.png")
    msg = msgpart1 + msgs[v0]
    img = images[v1]
    code = 'friends1-' + v0 + '.' + v1;
    url = window.location.host;
    picurl = url + '/static/' + img, 
    console.log(url, picurl);
    FB.ui(
    {
        method: 'stream.publish',
/*         description: '{{subhead}}', */
        description: msg,
        picture: picurl, 
        name: 'Django Mini Lean',
        link: url + '?code=' + code,
/*
        action_links: [
            { text: 'Code', href: 'http://demdash.us/friends/' }
        ],
        user_prompt_message: 'Personal message here'
*/
        },
        function(response) {
            if (response && response.post_id) {
                $.post('/fbshare/{{code}}')
                //alert('Thanks so much. You rock!');
            }
            else
            {
                //alert('Post was not published.');
            }
    }
    );  
}
</script>


<style type="text/css">


      button, button[type] {
        background-image: linear-gradient(#206db0 0%,#185386 100%);
        background-color: #206DB0;
        border: none;
        -webkit-border-radius: 22px;
        -moz-border-radius: 22px;
        border-radius: 22px;
        -webkit-box-shadow: 0 1px 0 rgba(0,0,0,0.3);
        -moz-box-shadow: 0 1px 0 rgba(0,0,0,0.3);
        box-shadow: 0 1px 0 rgba(0,0,0,0.3);
        color: #fff;
        cursor: pointer;
        font-size: 1.2em;
        font-family: Brown-Medium,Verdana,Helvetica,Arial,sans-serif;
        padding: 8px 25px 8px;
        text-shadow: -2px -1px 0 #144e7b;
        line-height: 1.1em;
      }

      button:hover, a.button:hover {
        border: 1px solid #c2e1ef;
        color: white;
        background-color: green;
      }

      input[type=text], input[type=url], select, textarea {
        display: inline-block;
        -o-border-radius: 22px;
        -moz-border-radius: 22px;
        -webkit-border-radius: 22px;
        border-radius: 22px;
        outline: 0;
        -moz-box-shadow: inset 0px 4px 8px #ddd;
        -webkit-box-shadow: inset 0px 4px 8px #ddd;
        box-shadow: inset 0px 4px 8px #ddd;
        box-sizing: border-box;
        border: 1px solid #ccc;
        padding: 6px 6px 6px 1em;
        height: 35px;
        min-height: 1em;
        background-color: #fff;
        font-family: "Brown-Light","Lucida Grande",Helvetica Neue,Arial;
        font-size: 16px;
      }


.home-big {font-size: 20px; font-weight: bold; font-family: arial;}
td {font-size: 12px; padding-top:3px; padding-left: 7px; padding-right: 7px; font-family: arial;}
.button {
	-moz-box-shadow:inset 0px 1px 0px 0px #d197fe;
	-webkit-box-shadow:inset 0px 1px 0px 0px #d197fe;
	box-shadow:inset 0px 1px 0px 0px #d197fe;
	background:-webkit-gradient( linear, left top, left bottom, color-stop(0.05, #a53df6), color-stop(1, #7c16cb) );
	background:-moz-linear-gradient( center top, #a53df6 5%, #7c16cb 100% );
	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#a53df6', endColorstr='#7c16cb');
	background-color:#a53df6;
	-moz-border-radius:6px;
	-webkit-border-radius:6px;
	border-radius:6px;
	border:1px solid #9c33ed;
	display:inline-block;
	color:#ffffff;
	font-family:arial;
	font-size:15px;
	font-weight:bold;
	padding:6px 24px;
	text-decoration:none;
	text-shadow:1px 1px 0px #7d15cd;
}.button:hover {
	background:-webkit-gradient( linear, left top, left bottom, color-stop(0.05, #7c16cb), color-stop(1, #a53df6) );
	background:-moz-linear-gradient( center top, #7c16cb 5%, #a53df6 100% );
	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#7c16cb', endColorstr='#a53df6');
	background-color:#7c16cb;
}.button:active {
	position:relative;
	top:1px;
}
/* This imageless css button was generated by CSSButtonGenerator.com */
</style>

{% endblock %}

{% block content %}

<div style="text-align: center; margin-left: auto; margin-right: auto; width: 700px; height: 80px;">

    <div class="home-big">{{title}}</div>
    <div class="home-lessbig">{{description}}</div>
    
    <img src="/static/{{img}}">
    
    <br/>
    <a href="#" class="button" onclick="fb_publish();">share</a>

    <br/>
    <a href="/reset">reset n' randomize</a><br/><br/>
    <a href="/admin">admin</a><br/>(cow/moo)
</div>


{% endblock %}

</body>
</html>
