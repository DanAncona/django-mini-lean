<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">
<head>
  <meta charset="utf-8" />
  <title>DemDash: {% block title %}{% endblock %}</title>
  <link rel="image_src" href="{{ MEDIA_URL }}img/shinydemdash.png" />  
  <link rel="shortcut icon" href="{{ MEDIA_URL }}img/favicon.ico" />
  <link rel="stylesheet" href="{{ MEDIA_URL }}css/base.css" />  
  {% block headstyle %}{% endblock %}
  <!--script type="text/javascript" src="{{ MEDIA_URL }}js/jquery-1.3.2.min.js"></script-->
  <script type="text/javascript" src="{{ MEDIA_URL }}js/jquery-1.6.2.min.js"></script>
  <script type="text/javascript" src="{{ MEDIA_URL }}js/jquery.form.js"></script>
  <script type="text/javascript" src="{{ MEDIA_URL }}js/jquery.ghosttext.js"></script>  
  <script type="text/javascript" src="{{ MEDIA_URL }}js/jquery.validate.min.js"></script>    
  <!--script type="text/javascript" src="{{ MEDIA_URL }}js/demdash-base.js"></script-->
  <script type="text/javascript" src="/media/js/demdash-base.js"></script>
  <meta property="fb:app_id" content="110354265721605" /> 
{% block headscript %}{% endblock %}
</head>

{% load tags %}

{% block headscript %}
<meta property="og:url" content="http://demdash.us/friends" />
<meta property="og:image" content="http://demdash.us{{ MEDIA_URL }}img/{{img}}" />
<meta property="og:title" content="Democracy Dashboard" />
<meta property="og:description" content="Curious to see how political your Facebook feed is?" />
<meta property="og:type" content="website" />

<link rel="stylesheet" href="{{ MEDIA_URL }}css/widesinglecolumn.css" />

<script type="text/javascript">
$.ajaxSetup({ 
     beforeSend: function(xhr, settings) {
         function getCookie(name) {
             var cookieValue = null;
             if (document.cookie && document.cookie != '') {
                 var cookies = document.cookie.split(';');
                 for (var i = 0; i < cookies.length; i++) {
                     var cookie = jQuery.trim(cookies[i]);
                     // Does this cookie string begin with the name we want?
                 if (cookie.substring(0, name.length + 1) == (name + '=')) {
                     cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                     break;
                 }
             }
         }
         return cookieValue;
         }
         if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {
             // Only send the token to relative URLs i.e. locally.
             xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
         }
     } 
});

window.fbAsyncInit = function() {
  FB.init({
    appId      : '{{FACEBOOK_APP_ID}}',
    status     : true,
    logging    : true,
    cookie     : true,
    xfbml      : true,
    oauth      : true,
  });
};
(function(d){
   var js, id = 'facebook-jssdk'; if (d.getElementById(id)) {return;}
   js = d.createElement('script'); js.id = id; js.async = true;
   js.src = "//connect.facebook.net/en_US/all.js";
   d.getElementsByTagName('head')[0].appendChild(js);
 }(document));

function fb_publish() {
    v0 = Math.floor(Math.random()*2);
    v1 = Math.floor(Math.random()*2);
    console.log(v0, v1);
    msgpart1 = '{{request.user.get_profile.fname}} is {{nums.pct|floatformat:'0'}}% {{nums.ideology}} and {{nums.total|floatformat:'0'}}% political overall. ';
    msgs = Array('Curious to see how political your Facebook feed is?', 'Curious to see how your friends are connected?')
    images = Array("friendstest-d3.png", "friendstest-nodexl.png")
    msg = msgpart1 + msgs[v0]
    img = images[v1]
    code = 'friends1-' + v0 + '.' + v1;
    FB.ui(
    {
        method: 'stream.publish',
/*         description: '{{subhead}}', */
        description: msg,
        picture: 'http://demdash.us{{ MEDIA_URL }}img/' + img, 
        name: 'Democracy with Friends',
        link: 'http://demdash.us/friends?code=' + code,
/*
        action_links: [
            { text: 'Code', href: 'http://demdash.us/friends/' }
        ],
        user_prompt_message: 'Personal message here'
*/
        },
        function(response) {
            if (response && response.post_id) {
                $.post('/fbshare/{{code}}')
                //alert('Thanks so much. You rock!');
            }
            else
            {
                //alert('Post was not published.');
            }
    }
    );  
}
</script>

<style>
    td {font-size: 12px; padding-top:3px; padding-left: 7px; padding-right: 7px; font-family: arial;}
</style>

{% endblock %}

{% block title %}
    Democracy with Friends
{% endblock %}

{% block content %}
{% load humanize %}
{% demdash_facebook_js %}

<div style="text-align: center; margin-left: auto; margin-right: auto;">

{% if not user.is_authenticated %}

<div class="home-big">Democracy with Friends</div>
<div class="home-lessbig">{{subhead}}</div>

<img src="{{ MEDIA_URL }}img/{{img}}">

<div class="messagebox" style="text-align: center; margin-left: auto; margin-right: auto; width: 700px; height: 80px;">

    <div style="clear: none; font-size:12px;">
      <div style="font-size: 14px; font-weight: bold; margin-bottom: 3px;">
      Connect with Facebook to try this out:</div>
    </div>
    <form id="homejoin-joinfb" action="/joinfb" method="POST" style="text-align: center; margin-left: auto; margin-right: auto; width: 700px; margin-top: 8px; margin-bottom: 8px;">
        <input type="hidden" name="nextlink" value="/friends/"/>
        <div id='fb-root'></div>
        {% load facebook_tags %}
        {% demdash_facebook_button %}

    </form>
    <p>Your scores and map are private unless you choose to share them. We won't post anything to Facebook without your permission.</p>
</div>

{% else %}

{% endif %}
</div>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-210605-11");
pageTracker._trackPageview();
} catch(err) {}</script>

</body>
{% block footerscript %}{% endblock %}
</html>
